#!/usr/bin/ansible-playbook
---
#
#      Copyright (c) 2016 F5 Networks
#      All rights reserved.
#
#      author: Mark Lowcher F5 Networks
#      description: This playbook will run a qkview on the systems defined as [loadbalancer]
#      in the /etc/ansible/hosts file. It will wait 45 seconds for the qkview to complete 
#      and then scp it to the destination and path seen in the "Get qkview play.
#      It will then delete all qkviews on the target loadbalancer. 
#

   - hosts: loadbalancer[0]
     tasks:
       - name: Run qkview
         raw: qkview      

       - name: Wait HA IP Info
         wait_for:
           timeout: 10

       - name: Get qkview
         raw: scp -r /var/tmp/*.qkview root@10.0.0.182:/config/qkview/

       - name: delete qkview from F5 devices
         raw: rm -f /var/tmp/*.qkview
 
